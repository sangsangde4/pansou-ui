<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PanSou - ç½‘ç›˜èµ„æºæœç´¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            /* é˜²æ­¢é¡µé¢çªç„¶å˜å®½ */
            overflow-x: hidden;
            width: 100%;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            /* ç¡®ä¿å®¹å™¨å§‹ç»ˆå±…ä¸­ä¸”ä¸è¶…å‡ºè§†å£ */
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            /* é˜²æ­¢å†…å®¹æº¢å‡º */
            overflow: hidden;
        }

        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            /* é˜²æ­¢è¾“å…¥æ¡†è¶…å‡ºå®¹å™¨ */
            max-width: 100%;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            /* é˜²æ­¢æŒ‰é’®å˜å½¢ */
            flex-shrink: 0;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .advanced-options {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .options-toggle {
            background: none;
            border: none;
            color: #667eea;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .options-content {
            display: none;
            gap: 15px;
            flex-wrap: wrap;
        }

        .option-group {
            flex: 1;
            min-width: 200px;
        }

        .option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .option-group select, .option-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            /* é˜²æ­¢è¡¨å•å…ƒç´ æº¢å‡º */
            max-width: 100%;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading {
            text-align: center;
            /*padding: 40px;*/
            color: #667eea;
            font-size: 16px;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #667eea;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            /*margin-left: 10px;*/
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            /* é˜²æ­¢ç»“æœåŒºåŸŸæº¢å‡º */
            overflow: hidden;
            width: 100%;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            /* é˜²æ­¢headerå†…å®¹æº¢å‡º */
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-count {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            /* é˜²æ­¢æ ‡ç­¾æº¢å‡º */
            max-width: 100%;
            overflow-x: auto;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            /* é˜²æ­¢æ ‡ç­¾æ–‡å­—æ¢è¡Œ */
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .platform-icons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            /* é˜²æ­¢å›¾æ ‡æº¢å‡º */
            overflow-x: auto;
        }

        .platform-icon {
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            text-align: center;
            min-width: 80px;
            /* é˜²æ­¢å›¾æ ‡å˜å½¢ */
            flex-shrink: 0;
        }

        .platform-baidu { background: #3385ff; }
        .platform-aliyun { background: #ff6a00; }
        .platform-quark { background: #00c896; }
        .platform-tianyi { background: #1890ff; }
        .platform-uc { background: #ff4d4f; }
        .platform-mobile { background: #52c41a; }
        .platform-115 { background: #722ed1; }
        .platform-pikpak { background: #fa541c; }
        .platform-xunlei { background: #13c2c2; }
        .platform-123 { background: #eb2f96; }
        .platform-magnet { background: #595959; }
        .platform-ed2k { background: #fa8c16; }

        .results-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            /* é˜²æ­¢ç½‘æ ¼æº¢å‡º */
            width: 100%;
        }

        .result-card {
            border: 1px solid #e8e8e8;
            border-radius: 12px;
            padding: 20px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            /* é˜²æ­¢å¡ç‰‡å†…å®¹æº¢å‡º */
            overflow: hidden;
            word-wrap: break-word;
            word-break: break-all;
        }

        .result-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .result-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            line-height: 1.4;
            flex: 1;
            /* é˜²æ­¢æ ‡é¢˜æº¢å‡º */
            overflow: hidden;
            word-wrap: break-word;
            word-break: break-all;
        }

        .result-time {
            font-size: 12px;
            color: #999;
            margin-left: 10px;
            /* é˜²æ­¢æ—¶é—´æ¢è¡Œ */
            white-space: nowrap;
            flex-shrink: 0;
        }

        .result-content {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
            max-height: 60px;
            overflow: hidden;
            /* é˜²æ­¢å†…å®¹æº¢å‡º */
            word-wrap: break-word;
            word-break: break-all;
        }

        .result-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .result-link {
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            color: white;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            /* é˜²æ­¢é“¾æ¥æ–‡å­—æ¢è¡Œ */
            white-space: nowrap;
        }

        .result-link:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .result-password {
            background: #f0f0f0;
            color: #666;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
            /* é˜²æ­¢å¯†ç æ–‡å­—æ¢è¡Œ */
            white-space: nowrap;
            text-align: center;
            line-height: 40px;
        }

        .error-message {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            border-radius: 8px;
            padding: 15px;
            color: #a8071a;
            margin-top: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .search-form {
                flex-direction: column;
            }

            .search-input {
                min-width: unset;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .filter-tabs {
                justify-content: flex-start;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
            }

            .platform-icons {
                justify-content: center;
            }
        }

        /* å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .search-section {
                padding: 20px;
            }

            .results-section {
                padding: 20px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .result-card {
                padding: 15px;
            }

            .filter-tabs {
                font-size: 12px;
            }

            .platform-icon {
                min-width: 60px;
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ” PanSou</h1>
        <p>é«˜æ€§èƒ½ç½‘ç›˜èµ„æºæœç´¢å¼•æ“ - æ”¯æŒå¤šå¹³å°å¹¶å‘æœç´¢</p>
    </div>

    <div class="search-section">
        <form class="search-form" onsubmit="handleSearch(event)">
            <input type="text" class="search-input" id="searchInput" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¦‚ï¼šé€Ÿåº¦ä¸æ¿€æƒ…" required>
            <button type="submit" class="search-btn" id="searchBtn">æœç´¢</button>
        </form>

        <div class="advanced-options">
            <button class="options-toggle" onclick="toggleOptions()">
                <span id="optionsToggleText">â–¼ é«˜çº§é€‰é¡¹</span>
            </button>
            <div class="options-content" id="optionsContent">
                <div class="option-group">
                    <label for="sourceSelect">æ•°æ®æ¥æº:</label>
                    <select id="sourceSelect">
                        <option value="all">å…¨éƒ¨æ¥æº</option>
                        <option value="tg">ä»…Telegram</option>
                        <option value="plugin">ä»…æ’ä»¶</option>
                    </select>
                </div>
                <div class="option-group">
                    <label for="resultType">ç»“æœç±»å‹:</label>
                    <select id="resultType">
                        <option value="merge">æŒ‰ç±»å‹åˆå¹¶</option>
                        <option value="results">è¯¦ç»†ç»“æœ</option>
                        <option value="all">å…¨éƒ¨æ•°æ®</option>
                    </select>
                </div>
                <div class="option-group">
                    <label for="concurrency">å¹¶å‘æ•°:</label>
                    <input type="number" id="concurrency" min="1" max="20" value="10">
                </div>
                <div class="option-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="refreshCache">
                        <label for="refreshCache">å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="results-section" id="resultsSection">
        <div class="results-header">
            <div class="results-count" id="resultsCount">æ‰¾åˆ° 0 ä¸ªç»“æœ</div>
            <div class="filter-tabs" id="filterTabs">
            </div>
        </div>

        <div class="platform-icons" id="platformIcons"></div>

        <div class="results-grid" id="resultsGrid"></div>
    </div>
</div>

<script>
    let searchResults = [];
    let currentFilter = 'all';
    const API_BASE = 'https://pansou.252035.xyz/api'; // ä¿®æ”¹ä¸ºå®é™…çš„APIåœ°å€

    // å¹³å°é…ç½®
    const platforms = {
        baidu: { name: 'ç™¾åº¦ç½‘ç›˜', class: 'platform-baidu' },
        aliyun: { name: 'é˜¿é‡Œäº‘ç›˜', class: 'platform-aliyun' },
        quark: { name: 'å¤¸å…‹ç½‘ç›˜', class: 'platform-quark' },
        tianyi: { name: 'å¤©ç¿¼äº‘ç›˜', class: 'platform-tianyi' },
        uc: { name: 'UCç½‘ç›˜', class: 'platform-uc' },
        mobile: { name: 'ç§»åŠ¨äº‘ç›˜', class: 'platform-mobile' },
        '115': { name: '115ç½‘ç›˜', class: 'platform-115' },
        pikpak: { name: 'PikPak', class: 'platform-pikpak' },
        xunlei: { name: 'è¿…é›·ç½‘ç›˜', class: 'platform-xunlei' },
        '123': { name: '123ç½‘ç›˜', class: 'platform-123' },
        magnet: { name: 'ç£åŠ›é“¾æ¥', class: 'platform-magnet' },
        ed2k: { name: 'eMuleé“¾æ¥', class: 'platform-ed2k' }
    };

    function toggleOptions() {
        const content = document.getElementById('optionsContent');
        const toggle = document.getElementById('optionsToggleText');

        if (content.style.display === 'flex') {
            content.style.display = 'none';
            toggle.textContent = 'â–¼ é«˜çº§é€‰é¡¹';
        } else {
            content.style.display = 'flex';
            toggle.textContent = 'â–² é«˜çº§é€‰é¡¹';
        }
    }

    async function handleSearch(event) {
        event.preventDefault();

        const keyword = document.getElementById('searchInput').value.trim();
        if (!keyword) return;

        const searchBtn = document.getElementById('searchBtn');
        const resultsSection = document.getElementById('resultsSection');

        searchBtn.disabled = true;
        searchBtn.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';

        try {
            const params = {
                kw: keyword,
                src: document.getElementById('sourceSelect').value,
                res: document.getElementById('resultType').value,
                conc: parseInt(document.getElementById('concurrency').value),
                refresh: document.getElementById('refreshCache').checked
            };

            const response = await fetch(`${API_BASE}/search`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(params)
            });

            if (!response.ok) {
                throw new Error(`æœç´¢å¤±è´¥: ${response.status}`);
            }

            const result = await response.json();

            // æ£€æŸ¥è¿”å›çš„æ•°æ®ç»“æ„
            if (result.code === 0 && result.data) {
                searchResults = result.data;
                displayResults(result.data);
                resultsSection.style.display = 'block';
            } else {
                throw new Error(result.message || 'æœç´¢å¤±è´¥');
            }

        } catch (error) {
            console.error('æœç´¢é”™è¯¯:', error);
            showError(error.message);
        } finally {
            searchBtn.disabled = false;
            searchBtn.textContent = 'æœç´¢';
        }
    }

    function displayResults(data) {
        const resultsCount = document.getElementById('resultsCount');
        const filterTabs = document.getElementById('filterTabs');
        const platformIcons = document.getElementById('platformIcons');
        const resultsGrid = document.getElementById('resultsGrid');

        // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
        filterTabs.innerHTML = '';
        platformIcons.innerHTML = '';
        resultsGrid.innerHTML = '';

        // æ›´æ–°ç»“æœè®¡æ•°
        resultsCount.textContent = `æ‰¾åˆ° ${data.total || 0} ä¸ªç»“æœ`;

        // æ·»åŠ "å…¨éƒ¨"æ ‡ç­¾
        const allTab = document.createElement('div');
        allTab.className = 'filter-tab active';
        allTab.dataset.filter = 'all';
        allTab.textContent = `å…¨éƒ¨ (${data.total || 0})`;
        allTab.onclick = () => filterResults('all');
        filterTabs.appendChild(allTab);

        // åˆ›å»ºè¿‡æ»¤æ ‡ç­¾
        const availableTypes = Object.keys(data.merged_by_type || {});
        availableTypes.forEach(type => {
            const count = data.merged_by_type[type]?.length || 0;
            const tab = document.createElement('div');
            tab.className = 'filter-tab';
            tab.dataset.filter = type;
            tab.textContent = `${platforms[type]?.name || type} (${count})`;
            tab.onclick = () => filterResults(type);
            filterTabs.appendChild(tab);
        });

        // æ˜¾ç¤ºå¹³å°å›¾æ ‡
        availableTypes.forEach(type => {
            const icon = document.createElement('div');
            icon.className = `platform-icon ${platforms[type]?.class || ''}`;
            icon.textContent = platforms[type]?.name || type;
            platformIcons.appendChild(icon);
        });

        // é‡ç½®ä¸ºå…¨éƒ¨è¿‡æ»¤å™¨
        currentFilter = 'all';
        // æ˜¾ç¤ºç»“æœ
        displayFilteredResults(data, 'all');
    }

    function filterResults(type) {
        currentFilter = type;

        // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾å¹¶æ¿€æ´»
        const targetTab = document.querySelector(`[data-filter="${type}"]`);
        if (targetTab) {
            targetTab.classList.add('active');
        }

        displayFilteredResults(searchResults, type);
    }

    function displayFilteredResults(data, filterType) {
        const resultsGrid = document.getElementById('resultsGrid');
        resultsGrid.innerHTML = '';

        let results = [];

        if (filterType === 'all') {
            // æ˜¾ç¤ºæ‰€æœ‰ç±»å‹çš„ç»“æœ
            Object.keys(data.merged_by_type || {}).forEach(type => {
                const items = data.merged_by_type[type] || [];
                results.push(...items.map(item => ({
                    ...item,
                    type: type
                })));
            });
        } else {
            // æ˜¾ç¤ºç‰¹å®šç±»å‹çš„ç»“æœ
            const items = data.merged_by_type[filterType] || [];
            results = items.map(item => ({
                ...item,
                type: filterType
            }));
        }

        if (results.length === 0) {
            resultsGrid.innerHTML = `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <h3>æš‚æ— ç»“æœ</h3>
                    <p>å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æˆ–è°ƒæ•´æœç´¢æ¡ä»¶</p>
                </div>
            `;
            return;
        }

        // æŒ‰æ—¶é—´å€’åºæ’åº
        results.sort((a, b) => new Date(b.datetime || 0) - new Date(a.datetime || 0));

        results.forEach(result => {
            const card = createResultCard(result);
            resultsGrid.appendChild(card);
        });
    }

    function createResultCard(result) {
        const card = document.createElement('div');
        card.className = 'result-card';

        const platformInfo = platforms[result.type] || { name: result.type, class: '' };

        // å¤„ç†æ—¶é—´æ˜¾ç¤º
        const timeStr = formatTime(result.datetime);

        // å¤„ç†æ ‡é¢˜å’Œå†…å®¹
        const title = result.note || result.title || 'æœªçŸ¥èµ„æº';
        const content = result.content || '';

        // å¤„ç†å¯†ç æ˜¾ç¤º
        const passwordHtml = result.password ?
            `<span class="result-password">å¯†ç : ${result.password}</span>` : '';

        // åˆ›å»ºå¤åˆ¶é“¾æ¥æŒ‰é’®
        const copyBtnHtml = `
            <button class="result-link ${platformInfo.class}" onclick="copyToClipboard(event, '${result.url}', '${result.password || ''}')">
                ğŸ“‹ å¤åˆ¶é“¾æ¥
            </button>
        `;

        card.innerHTML = `
            <div class="result-header">
                <div class="result-title">${title}</div>
                <div class="result-time">${timeStr}</div>
            </div>
            <div class="result-content">
                <span class="platform-icon ${platformInfo.class}" style="display: inline-block; margin-right: 10px; margin-bottom: 10px;">
                    ${platformInfo.name}
                </span>
                ${content}
            </div>
            <div class="result-links">
                <a href="${result.url}" target="_blank" class="result-link ${platformInfo.class}">
                    ğŸ“ æ‰“å¼€é“¾æ¥
                </a>
                ${copyBtnHtml}
                ${passwordHtml}
            </div>
        `;

        return card;
    }

    function formatTime(dateString) {
        if (!dateString) return '';

        const date = new Date(dateString);
        const now = new Date();
        const diffTime = now - date;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 0) {
            return 'ä»Šå¤©';
        } else if (diffDays === 1) {
            return 'æ˜¨å¤©';
        } else if (diffDays < 7) {
            return `${diffDays}å¤©å‰`;
        } else {
            return date.toLocaleDateString('zh-CN');
        }
    }

    function showError(message) {
        const resultsSection = document.getElementById('resultsSection');
        const resultsGrid = document.getElementById('resultsGrid');

        resultsGrid.innerHTML = `
            <div class="error-message">
                <h3>æœç´¢å‡ºé”™</h3>
                <p>${message}</p>
                <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</p>
            </div>
        `;

        resultsSection.style.display = 'block';
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
    function copyToClipboard(event, url, password) {
        let textToCopy = url;
        if (password) {
            textToCopy += `\nå¯†ç : ${password}`;
        }

        navigator.clipboard.writeText(textToCopy).then(() => {
            // ç®€å•çš„æç¤ºåé¦ˆ
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = 'âœ… å·²å¤åˆ¶';
            button.style.background = '#52c41a';

            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = '';
            }, 2000);
        }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
        });
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åˆå§‹åŒ–é€»è¾‘
    });
</script>
</body>
</html>
